<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FleetTrack Pro - Login</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script src="https://unpkg.com/feather-icons"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>

    <script>
      // Configuração do Tailwind (do seu novo layout)
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              primary: '#3b82f6',
              secondary: '#10b981'
            }
          }
        }
      }
    </script>
</head>
<body class="bg-gray-50 min-h-screen flex items-center justify-center">
  <div class="login-container w-full max-w-md px-6 py-8">
    <div class="bg-white rounded-xl shadow-xl overflow-hidden">
      <div class="bg-primary py-6 px-8 text-center">
        <div class="flex justify-center mb-4">
          <i data-feather="truck" class="text-white w-12 h-12"></i>
        </div>
        <h1 class="text-2xl font-bold text-white">FleetTrack Pro</h1>
        <p class="text-primary-100 mt-1">Sistema de Registro de Frotas</p>
      </div>
      
      <div class="px-8 py-6">
        <h2 id="formTitle" class="text-xl font-bold text-center text-dark mb-6">Acessar o Sistema</h2>

        <form id="authForm" class="space-y-6">
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700 mb-1">E-mail</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i data-feather="mail" class="text-gray-400"></i>
              </div>
              <input type="email" id="email" name="email" required 
                class="pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
          </div>
          
          <div>
            <label for="password" class="block text-sm font-medium text-gray-700 mb-1">Senha</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i data-feather="lock" class="text-gray-400"></i>
              </div>
              <input type="password" id="password" name="password" required 
                class="pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
          </div>

          <div id="confirmPasswordBlock" class="hidden">
            <label for="confirmPassword" class="block text-sm font-medium text-gray-700 mb-1">Confirmar Senha</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i data-feather="lock" class="text-gray-400"></i>
              </div>
              <input type="password" id="confirmPassword" name="confirmPassword" 
                class="pl-10 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-primary focus:border-primary">
            </div>
          </div>
          
          <div class="flex items-center justify-between">
            <div class="flex items-center">
              <input id="remember-me" name="remember-me" type="checkbox" 
                class="h-4 w-4 text-primary focus:ring-primary border-gray-300 rounded">
              <label for="remember-me" class="ml-2 block text-sm text-gray-700">Lembrar-me</label>
            </div>
            
            <div class="text-sm">
              <a href="#" class="font-medium text-primary hover:text-primary-600">Esqueceu sua senha?</a>
            </div>
          </div>
          
          <p id="errorMessage" class="text-sm text-red-600 text-center hidden"></p>

          <div>
            <button id="submitButton" type="submit" 
              class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-primary hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary transition-colors duration-200">
              Entrar
            </button>
          </div>
        </form>

        <div class="text-sm text-center mt-4">
            <p class="text-gray-600">
              <span id="toggleTextPrompt">Não tem uma conta? </span>
              <a href="#" id="toggleLink" class="font-medium text-primary hover:text-primary-600">Cadastre-se</a>
            </p>
        </div>

      </div>
      
      <div class="bg-gray-50 px-8 py-4 text-center">
        <p class="text-xs text-gray-500">
          © 2025 FleetTrack Pro. Todos os direitos reservados.
        </p>
      </div>
    </div>
  </div>

  <script>
    // --- CONFIGURAÇÃO DO FIREBASE (A mesma do index.html) ---
    const firebaseConfig = {
      apiKey: "AIzaSyCoIC7XR6N055JQ-XmSmMqVEXXFMtyqFL8", 
      authDomain: "sistema-de-registro-de-frota.firebaseapp.com",
      projectId: "sistema-de-registro-de-frota",
      storageBucket: "sistema-de-registro-de-frota.firebasestorage.app",
      messagingSenderId: "32018245872",
      appId: "1:32018245872:web:aadc8dc732e8a0bbdeba35",
      measurementId: "G-YG7NSFY35W"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    // --- FIM DA CONFIGURAÇÃO ---

    // --- (NOVO) LÓGICA DE LOGIN E CADASTRO ---
    
    // Seletores dos elementos
    const authForm = document.getElementById('authForm');
    const emailInput = document.getElementById('email');
    const passwordInput = document.getElementById('password');
    const confirmPasswordBlock = document.getElementById('confirmPasswordBlock');
    const confirmPasswordInput = document.getElementById('confirmPassword');
    const submitButton = document.getElementById('submitButton');
    const toggleLink = document.getElementById('toggleLink');
    const toggleTextPrompt = document.getElementById('toggleTextPrompt');
    const errorMessage = document.getElementById('errorMessage');
    const formTitle = document.getElementById('formTitle');

    let isLoginMode = true; // Começa em modo de Login

    // Alterna a interface entre Login e Cadastro
    toggleLink.addEventListener('click', (e) => {
        e.preventDefault();
        isLoginMode = !isLoginMode;
        errorMessage.classList.add('hidden'); // Limpa erros antigos

        if (isLoginMode) {
            formTitle.textContent = 'Acessar o Sistema';
            confirmPasswordBlock.classList.add('hidden');
            submitButton.textContent = 'Entrar';
            toggleTextPrompt.textContent = 'Não tem uma conta? ';
            toggleLink.textContent = 'Cadastre-se';
        } else {
            formTitle.textContent = 'Criar Nova Conta';
            confirmPasswordBlock.classList.remove('hidden');
            submitButton.textContent = 'Cadastrar';
            toggleTextPrompt.textContent = 'Já tem uma conta? ';
            toggleLink.textContent = 'Faça login';
        }
    });

    // Lida com o envio do formulário
    authForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = emailInput.value;
        const password = passwordInput.value;
        errorMessage.classList.add('hidden');

        if (isLoginMode) {
            // --- MODO LOGIN ---
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    window.location.href = './index.html'; // Redireciona para o app
                })
                .catch((error) => {
                    console.error("Erro de login:", error.code);
                    if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found' || error.code === 'auth/invalid-email') {
                        errorMessage.textContent = 'E-mail ou senha inválidos.';
                    } else {
                        errorMessage.textContent = 'Erro ao tentar fazer login.';
                    }
                    errorMessage.classList.remove('hidden');
                });
        } else {
            // --- MODO CADASTRO ---
            const confirmPassword = confirmPasswordInput.value;
            if (password !== confirmPassword) {
                errorMessage.textContent = 'As senhas não conferem.';
                errorMessage.classList.remove('hidden');
                return; // Para a execução
            }

            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Loga automaticamente e redireciona
                    window.location.href = './index.html'; 
                })
                .catch((error) => {
                    console.error("Erro de cadastro:", error.code);
                    if (error.code === 'auth/email-already-in-use') {
                        errorMessage.textContent = 'Este e-mail já está em uso.';
                    } else if (error.code === 'auth/weak-password') {
                        errorMessage.textContent = 'A senha deve ter pelo menos 6 caracteres.';
                    } else {
                        errorMessage.textContent = 'Erro ao criar conta.';
                    }
                    errorMessage.classList.remove('hidden');
                });
        }
    });

    // Ativa os ícones do Feather
    feather.replace();
  </script>
</body>
</html>